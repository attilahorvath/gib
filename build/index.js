!function(){"use strict";var t="uniform mat4 projection;uniform mat4 view;attribute vec3 vertex0Position;attribute vec2 vertex1TexCoord;varying vec2 texCoord;void main(){gl_PointSize=64.0;gl_Position=projection*view*vec4(vertex0Position,1.0);texCoord=vertex1TexCoord;}",e="precision highp float;uniform sampler2D tex;varying vec2 texCoord;void main(){vec2 texCoord=mix((vec2(16.0)*texCoord)/vec2(128.0,64.0),(vec2(16.0)*(texCoord+vec2(1.0)))/vec2(128.0,64.0),gl_PointCoord);gl_FragColor=texture2D(tex,texCoord);if(gl_FragColor.a<0.1){discard;}}",i="uniform mat4 projection;uniform mat4 view;uniform float time;attribute vec2 vertex0Position;attribute vec3 vertex1Color;attribute vec2 vertex2Velocity;attribute float vertex3Emitted;attribute float vertex4Lifetime;varying vec4 color;void main(){float age=time-vertex3Emitted;vec2 position=vertex0Position+vertex2Velocity*age;gl_PointSize=4.0;gl_Position=projection*view*vec4(position,0.9,1.0);color=vec4(vertex1Color,1.0-smoothstep(0.0,vertex4Lifetime,age));}",s="precision highp float;varying vec4 color;void main(){gl_FragColor=color;}",r="uniform mat4 projection;attribute vec2 vertex0Position;attribute vec2 vertex1TexCoord;attribute float vertex2Size;varying vec2 texCoord;void main(){gl_PointSize=vertex2Size;gl_Position=projection*vec4(vertex0Position,0.95,1.0);texCoord=vertex1TexCoord;}",h="precision highp float;uniform sampler2D tex;varying vec2 texCoord;void main(){vec2 texCoord=mix(texCoord,texCoord+vec2(8.0/128.0,8.0/64.0),gl_PointCoord);gl_FragColor=texture2D(tex,texCoord);if(gl_FragColor.a<0.1){discard;}}";const a=(t,e)=>{switch(e){case t.FLOAT:return 1;case t.FLOAT_VEC2:return 2;case t.FLOAT_VEC3:return 3;case t.FLOAT_VEC4:return 4;case t.FLOAT_MAT3:return 9;case t.FLOAT_MAT4:return 16}};class n{constructor(t,e,i){this.gl=t;const s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,e),t.compileShader(s);const r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,i),t.compileShader(r),this.program=t.createProgram(),t.attachShader(this.program,s),t.attachShader(this.program,r),t.linkProgram(this.program),this.uniforms=[];const h=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<h;e++){const i=t.getActiveUniform(this.program,e),s=t.getUniformLocation(this.program,i.name);this[i.name]=null,this.uniforms.push({type:i.type,name:i.name,location:s})}this.attributes=[],this.stride=0;const n=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<n;e++){const i=t.getActiveAttrib(this.program,e),s=t.getAttribLocation(this.program,i.name),r=a(t,i.type);this.attributes.push({name:i.name,location:s,components:r}),this.stride+=4*r}this.attributes.sort((t,e)=>t.name<e.name?-1:1)}use(){this.gl.useProgram(this.program);let t=0;for(const e of this.attributes)this.gl.enableVertexAttribArray(e.location),this.gl.vertexAttribPointer(e.location,e.components,this.gl.FLOAT,!1,this.stride,t),t+=4*e.components;for(const t of this.uniforms)switch(t.type){case this.gl.FLOAT:this.gl.uniform1f(t.location,this[t.name]);break;case this.gl.FLOAT_VEC2:this.gl.uniform2fv(t.location,this[t.name]);break;case this.gl.FLOAT_MAT2:this.gl.uniformMatrix2fv(t.location,!1,this[t.name]);break;case this.gl.FLOAT_MAT4:this.gl.uniformMatrix4fv(t.location,!1,this[t.name])}}}class o{constructor(t,e=null,i=!1){this.timeout=t,this.callback=e,this.repeating=i,this.progress=0,this.enabled=!0}update(){this.enabled&&(this.progress+=1e3/60,this.progress>=this.timeout&&(this.callback&&this.callback(),this.repeating?this.progress-=this.timeout:this.enabled=!1))}reset(){this.enabled=!0,this.progress=0}}class l{constructor(a){const l=document.createElement("canvas");l.width=1024,l.height=600,document.body.appendChild(l),this.gl=l.getContext("webgl",{antialias:!1}),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.clearColor(0,.53,1,1),this.spriteShader=new n(this.gl,t,e),this.particleShader=new n(this.gl,i,s),this.textShader=new n(this.gl,r,h),this.projection=new Float32Array([2/1024,0,0,0,0,-2/600,0,0,0,0,-1,0,-1,1,0,1]),this.view=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.cameraX=0,this.cameraY=0,this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),this.setUpTexture();const c=new Image;c.addEventListener("load",()=>{this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,c),this.setUpTexture(),a.loaded=!0}),c.crossOrigin="",c.src="textures/tiles.png",this.shakeTimer=new o(200),this.shakeTimer.enabled=!1}setUpTexture(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST)}createVertexBuffer(t){const e=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),e}updateVertex(t,e,i){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,e,i)}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}shake(){this.shakeTimer.reset()}update(){this.shakeTimer.update(),this.view[12]=-Math.round(this.cameraX),this.view[13]=-Math.round(this.cameraY),this.shakeTimer.enabled&&(this.view[12]+=10*(Math.random()-.5),this.view[13]+=10*(Math.random()-.5))}draw(t,e,i){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),t.projection=this.projection,t.view=this.view,t.use(),this.gl.drawArrays(this.gl.POINTS,0,i)}}const c="ArrowUp",d="ArrowDown",p="ArrowLeft",x="ArrowRight",u="KeyW",m="KeyS",g="KeyA",f="KeyD",b="KeyX",T="KeyZ",v="KeyK",y="KeyJ",A="Space";class S{constructor(){this.keysPressed=0,this.lastPressed=0,this.keysJustPressed=0,this.keysJustReleased=0,addEventListener("keydown",t=>{switch(t.code){case c:case u:this.keysPressed|=1,t.preventDefault();break;case d:case m:this.keysPressed|=2,t.preventDefault();break;case p:case g:this.keysPressed|=4,t.preventDefault();break;case x:case f:this.keysPressed|=8,t.preventDefault();break;case b:case v:case A:this.keysPressed|=32,t.preventDefault();break;case T:case y:this.keysPressed|=64,t.preventDefault()}}),addEventListener("keyup",t=>{switch(t.code){case c:case u:this.keysPressed&=-2,t.preventDefault();break;case d:case m:this.keysPressed&=-3,t.preventDefault();break;case p:case g:this.keysPressed&=-5,t.preventDefault();break;case x:case f:this.keysPressed&=-9,t.preventDefault();break;case b:case v:case A:this.keysPressed&=-33,t.preventDefault();break;case T:case y:this.keysPressed&=-65,t.preventDefault()}})}update(){this.keysJustPressed=this.keysPressed&~this.lastPressed,this.keysJustReleased=~this.keysPressed&this.lastPressed,this.lastPressed=this.keysPressed}pressed(t){return(this.keysPressed&t)===t}justPressed(t){return(this.keysJustPressed&t)===t}justReleased(t){return(this.keysJustReleased&t)===t}}class E{constructor(){this.active=!1,this.x=0,this.y=0,this.z=0,this.u=0,this.v=0}spawn(t,e,i,s,r,h,a){this.active=!0,this.x=t,this.y=e,this.z=i,this.u=s,this.v=r,h&&(h.init(this),this.controller=h),a&&(this.frames=a,this.currentFrame=0,this.frameDirection=-1,this.frameTimer=new o(100,()=>{this.currentFrame=(this.currentFrame+this.frameDirection)%this.frames.length,this.currentFrame<0&&(this.currentFrame=this.frames.length-1),this.u=this.frames[this.currentFrame][0],this.v=this.frames[this.currentFrame][1]},!0))}update(){if(this.controller&&this.controller.update(),this.frameTimer&&this.frameTimer.update(),!this.active)return!0;const t=this.oldX!==this.x||this.oldY!==this.y||this.oldZ!==this.z||this.oldU!==this.u||this.oldV!==this.v;return this.oldX=this.x,this.oldY=this.y,this.oldZ=this.z,this.oldU=this.u,this.oldV=this.v,t}}const w=8192,P=20;class R{constructor(t){this.renderer=t,this.vertexBuffer=t.createVertexBuffer(w*P),this.spriteVertex=new Float32Array(P/4),this.sprites=[];for(let t=0;t<w;t++)this.sprites.push(new E(t))}updateSprite(t,e){this.spriteVertex[0]=e.active?e.x+32:0,this.spriteVertex[1]=e.active?e.y+32:0,this.spriteVertex[2]=e.active?e.z:0,this.spriteVertex[3]=e.active?e.u:0,this.spriteVertex[4]=e.active?e.v:0,this.renderer.updateVertex(this.vertexBuffer,t*P,this.spriteVertex)}spawnSprite(t,e,i,s,r,h=null,a=null){for(let n=0;n<w;n++){const o=this.sprites[n];if(!o.active)return o.spawn(t,e,i,s,r,h,a),this.updateSprite(n,o),o}}update(){for(let t=0;t<w;t++){const e=this.sprites[t];e.active&&e.update()&&this.updateSprite(t,e)}}draw(){this.renderer.draw(this.renderer.spriteShader,this.vertexBuffer,w)}}const D=128,k=36;class L{constructor(t){this.renderer=t,this.vertexBuffer=t.createVertexBuffer(D*k),this.particleVertex=new Float32Array(k/4),this.nextIndex=0,this.time=0}emitParticle(t,e,i,s,r,h,a,n){this.particleVertex[0]=t,this.particleVertex[1]=e,this.particleVertex[2]=i,this.particleVertex[3]=s,this.particleVertex[4]=r,this.particleVertex[5]=h,this.particleVertex[6]=a,this.particleVertex[7]=this.time,this.particleVertex[8]=n,this.renderer.updateVertex(this.vertexBuffer,this.nextIndex*k,this.particleVertex),this.nextIndex=(this.nextIndex+1)%D}update(){this.time+=1e3/60}draw(){this.renderer.particleShader.time=this.time,this.renderer.draw(this.renderer.particleShader,this.vertexBuffer,D)}}class C{constructor(t,e,i,s,r,h){if(this.textLayer=t,this.size=i,this.chars=e,this.visible=!0,this.lastVisible=!0,1===s){for(const t of this.chars)t.size=0;this.nextChar=0,this.timer=new o(100,()=>{if(this.nextChar>=this.chars.length)this.timer.enabled=!1;else{this.chars[this.nextChar].size=this.size;for(const t of this.chars)this.textLayer.updateChar(t);this.nextChar++}},!0)}else if(0===s){for(const t of this.chars)t.size=0;this.timer=new o(500,()=>{this.visible=!this.visible},!0)}this.timer&&r&&(this.timer.enabled=!1,this.startTimer=new o(r,()=>{this.timer.enabled=!0,this.endTimer&&(this.endTimer.enabled=!0)}));for(const t of this.chars)this.textLayer.updateChar(t);h&&(this.endTimer=new o(h,()=>{this.hide()}),this.startTimer&&(this.endTimer.enabled=!1))}update(){if(this.startTimer&&this.startTimer.update(),this.timer&&this.timer.update(),this.endTimer&&this.endTimer.update(),this.visible&&!this.lastVisible)for(const t of this.chars)t.size=this.size,this.textLayer.updateChar(t);else if(!this.visible&&this.lastVisible)for(const t of this.chars)t.size=0,this.textLayer.updateChar(t);this.lastVisible=this.visible}hide(){this.visible=!1,this.startTimer&&(this.startTimer.enabled=!1),this.timer&&(this.timer.enabled=!1),this.endTimer&&(this.endTimer.enabled=!1)}}const _=512,V=20;class F{constructor(t){this.renderer=t,this.vertexBuffer=t.createVertexBuffer(_*V),this.charVertex=new Float32Array(V/4),this.nextIndex=0,this.titleText=null,this.helpText=null}updateChar(t){this.charVertex[0]=t.x+t.size/2,this.charVertex[1]=t.y+t.size/2,this.charVertex[2]=t.u,this.charVertex[3]=t.v,this.charVertex[4]=t.size,this.renderer.updateVertex(this.vertexBuffer,t.index*V,this.charVertex)}getUV(t){const e=t.charCodeAt(0);let i=null,s=null;return e>="A".charCodeAt(0)&&e<="P".charCodeAt(0)?(i=8*(t.charCodeAt(0)-"A".charCodeAt(0))/128,s=.5):e>="Q".charCodeAt(0)&&e<="Z".charCodeAt(0)&&(i=8*(t.charCodeAt(0)-"Q".charCodeAt(0))/128,s=.625),[i,s]}createSegment(t,e,i,s,r,h,a){let n=[],o=t;for(const r of i)if("\n"===r)e+=s+12,o=t;else{const[t,i]=this.getUV(r);if(null!==t&&null!==i){const r=this.nextIndex;this.nextIndex=(this.nextIndex+1)%_,n.push({index:r,x:o,y:e,u:t,v:i,size:s})}o+=s}return new C(this,n,s,r,h,a)}update(){this.titleText&&this.titleText.update(),this.helpText&&this.helpText.update()}draw(){this.renderer.draw(this.renderer.textShader,this.vertexBuffer,_)}}class O{speak(t){const e=new SpeechSynthesisUtterance(t);e.rate=1.2,e.pitch=.3,speechSynthesis.speak(e)}}var B="11111111111111111111111111111 G 11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\n22222222222222222222222222222   2222222222222222                       22222222222222222222222222222222222222222222222222222222\n22222222222222222222222222222   BBB        R                 D         22222222222222222222222222222222222222222222222222222222\n22222222222222222222222222222   BBB                 11  11  111        22222222222222222222222222222222222222222222222222222222\n22222222222222222222222222222   BBB   X  1111111111               11   22222222222222222222222222222222222222222222222222222222\n22222222222222222222222222222   22222222222       2                    22222222222222222222222222222222222222222222222222222222\n22222222222222      R              R    R         2                    22222222222222222222222222222222222222222222222222222222\n22222222222  R        D     E P       D     2222  2     1          111 22222222222222222222222222222222222222222222222222222222\n22222222222     11111111111111111111111111112222  2                    22222222222222222222222222222222222222222222222222222222\n22222222222     2222222222222 2    22      22222  211        111       22222222222222222222222222222222222222222222222222222222\n2222222222222    R       22   2 22  2  222   222  2                  D 22222222222222222222222222222222222222222222222222222222\n2222222222222            22     22 22 222222 222  2                111122222222222222222222222222222222222222222222222222222222\n2222222222222222         22 222222 22  22    222  2           D        22222222222222222222222222222222222222222222222222222222\n2222222222222222222 D    22      2  22 22 222222  2          1111      22222222222222222222222222222222222222222222222222222222\n22222222222222222221111  2222222 22    22     22  2  111               22222222222222222222222222222222222222222222222222222222\n222222222222222       R  2222    222222222222 22  2                    22222222222222222222222222222222222222222222222222222222\n222222222222222   D              222222222    22  2       1111         22222222222222222222222222222222222222222222222222222222\n22222222222222   1111111122222222222222222 22222  2              1111  22222222222222222222222222222222222222222222222222222222\n2    R           22222222222222222         22222  2                    22222222222222222222222222222222222222222222222222222222\n2         D   D  22222222222222222    2222222222  D           D  D  D  22222222222222222222222222222222222222222222222222222222\n2      1111111111222       R    22222 22222222221111111111111111111111122222222222222222222222222222222222222222222222222222222\n2222   2222222222222            22222 22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2      2222222222222            22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2    D        D        D E   D  22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2111111111111111111111111111111122222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222\n";class M{constructor(t){this.map=t,this.dx=0,this.dy=0,this.ax=0,this.ay=0,this.hitboxX=0,this.hitboxY=0,this.hitboxW=64,this.hitboxH=64}init(t){this.sprite=t}get x(){return this.sprite.x}get y(){return this.sprite.y}set x(t){this.sprite.x=t}set y(t){this.sprite.y=t}get left(){return this.x+this.hitboxX}get right(){return this.x+this.hitboxX+this.hitboxW-1}get top(){return this.y+this.hitboxY}get bottom(){return this.y+this.hitboxY+this.hitboxH-1}update(){this.dx+=this.ax*(1e3/60),this.dy+=this.ay*(1e3/60),this.dx>.5?this.dx=.5:this.dx<-.5&&(this.dx=-.5),this.dy>2?this.dy=2:this.dy<-2&&(this.dy=-2),this.x+=this.dx*(1e3/60),this.tileAt()&&(this.dx<0?this.x+=this.map.prevTileOffset(this.left):this.x-=this.map.nextTileOffset(this.right)+1),this.y+=this.dy*(1e3/60),this.tileAt()&&(this.dy<0?this.y+=this.map.prevTileOffset(this.top):this.y-=this.map.nextTileOffset(this.bottom)+1)}tileAt(t=0,e=0){return this.map.tileAt(this.left+t,this.top+e)||this.map.tileAt(this.left+t,this.bottom+e)||this.map.tileAt(this.right+t,this.top+e)||this.map.tileAt(this.right+t,this.bottom+e)}}class U extends M{constructor(t,e,i,s){super(e),this.renderer=t,this.input=i,this.particleSystem=s,this.abilities={propulsion:!1,elevation:!1,excavation:!1},this.direction=0,this.lastDirection=0}init(t){super.init(t),this.spawnX=this.x,this.spawnY=this.y,this.renderer.cameraX=this.x+32-512,this.renderer.cameraY=this.y+32-300}update(){const t=this.tileAt(0,1);t?(this.ay=0,this.dy=0):this.tileAt(0,-1)?(this.ay=.002,this.dy=0):this.ay=.002,this.input.pressed(4)&&this.abilities.propulsion?(this.ax>0&&(this.ax=0),this.tileAt(-1,0)?(this.dx=0,this.ax=0):this.ax-=.001,this.direction=-1,this.lastDirection=0):this.input.pressed(8)&&this.abilities.propulsion?(this.ax<0&&(this.ax=0),this.tileAt(1,0)?(this.dx=0,this.ax=0):this.ax+=.001,this.direction=1,this.lastDirection=0):(0!==this.direction&&(this.ax=-this.ax,this.lastDirection=this.direction,this.direction=0),(this.lastDirection>0&&this.dx<.001||this.lastDirection<0&&this.dx>.001||this.tileAt(-1,0)||this.tileAt(1,0))&&(this.dx=0,this.ax=0)),this.ax>.002?this.ax=.002:this.ax<-.002&&(this.ax=-.002),this.input.justPressed(32)&&0===this.ay&&this.abilities.elevation&&(this.dy=-.9),super.update(),this.dx<-.1?this.kickUpDirt(this.x+64-2,t):this.dx>.1&&this.kickUpDirt(this.x+1,t),this.sprite.frameTimer.timeout=t?100:40,this.sprite.frameTimer.enabled=0!==this.direction,this.sprite.frameDirection=Math.sign(this.direction),this.renderer.cameraX=this.x+32-512,this.renderer.cameraY=this.y+32-300}respawn(){this.x=this.spawnX,this.y=this.spawnY,this.ax=0,this.ay=0,this.vx=0,this.vy=0,this.direction=0,this.lastDirection=0}kickUpDirt(t,e){if(!e)return;const i=2*Math.random(),s="1"==e?0:.4,r="1"==e?.8:.27,h="1"==e?.33:0,a=t<this.x+32?-1:1;for(let e=0;e<i;e++)this.particleSystem.emitParticle(t,this.y+64-1,s,r,h,a*Math.random()*.25,.25*-Math.random(),200)}}class I extends M{constructor(t,e,i,s){super(e),this.renderer=t,this.gib=i,this.particleSystem=s,this.hitboxX=8,this.hitboxY=4,this.hitboxW=56,this.hitboxH=20,this.falling=!1,this.xOffset=0,this.yOffset=0,this.timer=new o(200,()=>{this.falling=!0}),this.timer.enabled=!1,this.fell=!1}init(t){super.init(t),this.baseX=this.x,this.baseY=this.y}update(){if(!this.fell){if(this.timer.update(),this.gib.left-50>this.right||this.gib.right+50<this.left||this.gib.bottom<this.top||this.gib.top-100>this.bottom||this.falling||(this.timer.enabled=!0),this.timer.enabled){const t=8*Math.random()-4,e=8*Math.random()-4;this.x=this.baseX+t,this.y=this.baseY+e}if(this.falling)if(this.tileAt(0,1)){this.ay=0,this.dy=0,this.falling=!1,this.fell=!0,this.renderer.shake();for(let t=0;t<50;t++)this.particleSystem.emitParticle(this.left+Math.random()*this.hitboxW,this.top+Math.random()*this.hitboxH,.86,.53,.33,.25*(Math.random()-.5),.125*-Math.random(),700)}else this.ay=.007,this.gib.left>this.right||this.gib.right<this.left||this.gib.top>this.bottom||this.gib.bottom<this.top||this.gib.respawn()}super.update()}}class N extends M{constructor(t,e,i,s,r,h){super(e),this.renderer=t,this.gib=i,this.particleSystem=s,this.textLayer=r,this.speech=h,this.hitboxX=12,this.hitboxY=24,this.hitboxW=40,this.hitboxH=40}update(){if(!(this.gib.left>this.right||this.gib.right<this.left||this.gib.top>this.bottom||this.gib.bottom<this.top)){this.collected(),this.sprite.active=!1,this.renderer.shake();const t=50;for(let e=0;e<t;e++){const i=2*Math.PI/t*e;this.particleSystem.emitParticle(this.left+this.hitboxW/2,this.top+this.hitboxH/2,.53,0,0,.2*Math.cos(i)+.05*(Math.random()-.5),.2*Math.sin(i)+.05*(Math.random()-.5),1e3)}}super.update()}}class X extends N{collected(){this.gib.abilities.propulsion=!0,this.textLayer.titleText=this.textLayer.createSegment(150,220,"PROPULSION SYSTEM ONLINE",32,1,0,4e3),this.textLayer.helpText=this.textLayer.createSegment(150,220,"USE THE ARROWS TO MOVE",32,1,4e3,4e3),this.speech.speak("PROPULSION SYSTEM ONLINE")}}class Y extends N{collected(){this.gib.abilities.elevation=!0,this.textLayer.titleText=this.textLayer.createSegment(150,220,"ELEVATION SYSTEM ONLINE",32,1,0,4e3),this.textLayer.helpText=this.textLayer.createSegment(150,220,"PRESS X TO JUMP",32,1,4e3,4e3),this.speech.speak("ELEVATION SYSTEM ONLINE")}}class z extends N{collected(){this.gib.abilities.excavation=!0,this.textLayer.titleText=this.textLayer.createSegment(150,220,"EXCAVATION SYSTEM ONLINE",32,1,0,4e3),this.textLayer.helpText=this.textLayer.createSegment(150,220,"HOLD Z TO BREAK BRICKS",32,1,4e3,4e3),this.speech.speak("EXCAVATION SYSTEM ONLINE")}}class H{constructor(t,e,i,s,r,h){const a=new U(t,this,i,s);this.tiles=[];const n=B.split("\n");for(let i=0;i<n.length;i++){this.tiles.push([]);for(let o=0;o<n[i].length;o++){const l=n[i][o];let c=null,d=0;switch(l){case"1":c=0;break;case"2":c=1;break;case"B":c=1,d=1;break;case"R":e.spawnSprite(64*o,64*i,.8,6,0,new I(t,this,a,s));break;case"D":e.spawnSprite(64*o,64*i,.8,0,1);break;case"G":e.spawnSprite(64*o,64*i,.7,2,0,a,[[2,0],[3,0],[4,0],[5,0]]);break;case"P":e.spawnSprite(64*o,64*i,.8,2,1,new X(t,this,a,s,r,h));break;case"E":e.spawnSprite(64*o,64*i,.8,3,1,new Y(t,this,a,s,r,h));break;case"X":e.spawnSprite(64*o,64*i,.8,4,1,new z(t,this,a,s,r,h))}null!==c?(e.spawnSprite(64*o,64*i,.1,c,d),this.tiles[i].push(l)):this.tiles[i].push(null)}}}tileAt(t,e){const i=this.tiles[Math.floor(e/64)];return i?i[Math.floor(t/64)]:null}prevTileOffset(t){return 64*(Math.floor(t/64)+1)-t}nextTileOffset(t){return t-64*Math.floor(t/64)}}class j{constructor(t,e,i){this.input=t,this.textLayer=e,this.speech=i,e.titleText=e.createSegment(35,50,"SYSTEMS OFFLINE",64,1),e.helpText=e.createSegment(200,200,"PRESS START TO BEGIN",32,0,2e3),this.loaded=!1,this.started=!1}update(){this.loaded||(this.speech.speak("SYSTEMS OFFLINE"),this.loaded=!0),this.input.justPressed(32)&&(this.textLayer.titleText.hide(),this.textLayer.helpText.hide(),this.started=!0)}}const G=new class{constructor(){this.renderer=new l(this),this.input=new S,this.spriteSheet=new R(this.renderer),this.particleSystem=new L(this.renderer),this.textLayer=new F(this.renderer),this.speech=new O,this.map=new H(this.renderer,this.spriteSheet,this.input,this.particleSystem,this.textLayer,this.speech),this.title=new j(this.input,this.textLayer,this.speech),this.lastTimestamp=0,this.timeAccumulator=0,this.loaded=!1}update(t){const e=t-this.lastTimestamp;for(this.lastTimestamp=t,this.timeAccumulator+=e;this.timeAccumulator>=1e3/60;)this.loaded&&(this.input.update(),this.title.started?this.spriteSheet.update():this.title.update(),this.particleSystem.update(),this.textLayer.update(),this.renderer.update()),this.timeAccumulator-=1e3/60}render(){this.renderer.clear(),this.spriteSheet.draw(),this.particleSystem.draw(),this.textLayer.draw()}},K=t=>{requestAnimationFrame(K),G.update(t),G.render()};requestAnimationFrame(K)}();
